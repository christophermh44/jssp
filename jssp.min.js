!function(a){window.globals=[],a.fn.jssp=function(b){var c=b.settings||{},e=(b.bypass||null,b.context||new(AudioContext||webkitAudioContext));return this.each(function(){var b=this,d=function(a){var c={agc:function(a,b,c){var d=a.createScriptProcessor(4096,2,2),e={};window.globals.push(d);var f=c.speed,g="rms"==c.type,h=c.maxgain;e.samplerate=a.sampleRate,e.rmsValues=[],e.rmsSize=256,e.rmsOldIndex=1,e.rmsIndex=0,e.rmsSum=0,e.previousGain=1,e.previousRms=0;var i=function(a){var b=+e.rmsValues[e.rmsOldIndex]||0;return e.rmsValues[e.rmsIndex]=a,e.rmsIndex=(e.rmsIndex+1)%e.rmsSize,e.rmsOldIndex=(e.rmsOldIndex+1)%e.rmsSize,e.rmsSum=e.rmsSum+a*a-b*b,Math.sqrt(e.rmsSum/e.rmsSize)||0};return d.onaudioprocess=function(a){for(var b=a.inputBuffer,c=a.outputBuffer,d=b.getChannelData(0),j=b.getChannelData(1),k=c.getChannelData(0),l=c.getChannelData(1),m=0;m<b.length;++m){var n=.5*d[m]+.5*j[m];g&&(n=i(n));var o=20*Math.log10(n),p=1;o>e.previousRms&&(p=-1),gain=e.previousGain+p*f/(.5*e.samplerate),n*gain>1&&(gain=1/n),gain=Math.min(gain,h),e.previousGain=gain,e.previousRms=o,k[m]=d[m]*gain,l[m]=j[m]*gain}},b.connect(d),d},gain:function(a,b,c){var d=a.createGain();return d.gain.value=c.gain,b.connect(d),d},filter:function(a,b,c){var d=a.createBiquadFilter();return d.type=c.type,d.frequency.value=c.frequency,d.Q.value=c.q,d.gain.value=c.gain,b.connect(d),d},compressor:function(a,b,c){var d=a.createDynamicsCompressor();return d.attack.value=c.attack,d.release.value=c.release,d.ratio.value=c.ratio,d.threshold.value=c.threshold,b.connect(d),d},monoband:function(a,b,d){var e=c.filter(a,b,{type:"bandpass",frequency:d.centerFrequency,q:.5,gain:1}),f=c.compressor(a,e,{attack:d.attack,release:d.release,ratio:d.ratio,threshold:d.threshold}),g=c.gain(a,f,{gain:d.gain});return g},multiband:function(a,b,d){var f=a.createGain();for(var g in d.bands){var h=d.bands[g],i=c.monoband(a,b,h);i.connect(f)}return f}},d=e.createMediaElementSource(b),f=e.createGain(),g=d,h=null;for(var i in a){var j=a[i];g=c[j.type](e,g,j.settings),h||(h=g)}g.connect(f),f.connect(e.destination),h&&d.connect(h)};if("string"==typeof c)a.get(c,function(a){var b=JSON.parse(a);d(b)});else if("function"==typeof c)d(c());else{if("object"!=typeof c)throw new Exception("jssp could not initialize.");d(c)}})}}(jQuery);
